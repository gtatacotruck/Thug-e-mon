<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THUG-E-MON | PUBLIC BETA</title>
    <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #0a0a0a;
            --primary: #ffd700;
            --secondary: #ff3333;
            --accent: #00ffcc;
            --glass: rgba(255, 255, 255, 0.05);
        }

        * { box-sizing: border-box; user-select: none; }
        body { background-color: var(--bg-color); color: white; font-family: 'Roboto Mono', monospace; margin: 0; overflow: hidden; height: 100vh; }
        
        .watermark { position: fixed; top: 10px; right: 10px; font-family: 'Permanent Marker'; color: rgba(255, 255, 255, 0.2); font-size: 1.2rem; z-index: 999; pointer-events: none; border: 1px solid rgba(255,255,255,0.1); padding: 5px 10px; }

        h1, h2, h3, h4 { font-family: 'Permanent Marker', cursive; text-transform: uppercase; letter-spacing: 2px; margin: 5px 0; }
        .hidden { display: none !important; }
        
        .btn { background: linear-gradient(45deg, #333, #000); border: 2px solid var(--primary); color: var(--primary); padding: 12px 24px; font-family: 'Permanent Marker', cursive; font-size: 1rem; cursor: pointer; transition: 0.2s; margin: 5px; text-shadow: 0 0 5px var(--primary); }
        .btn:hover { transform: scale(1.05); background: var(--primary); color: black; }
        .btn-danger { border-color: var(--secondary); color: var(--secondary); }

        .screen { width: 100%; height: 100%; position: absolute; top: 0; left: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; background: radial-gradient(circle, #1a1a1a 0%, #000 100%); animation: fadeIn 0.4s; }
        input { background: rgba(255,255,255,0.05); border: none; border-bottom: 2px solid var(--accent); color: white; font-size: 1.2rem; text-align: center; padding: 10px; outline: none; margin: 5px; }

        .dashboard { display: grid; grid-template-columns: 1fr 2fr 1fr; width: 95%; height: 85%; gap: 15px; margin-top: 20px; }
        .panel { background: var(--glass); border: 1px solid #333; padding: 15px; border-radius: 10px; overflow-y: auto; }
        
        .inventory-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(70px, 1fr)); gap: 8px; }
        .inv-item { border: 2px solid #444; cursor: pointer; border-radius: 5px; overflow: hidden; transition: 0.2s; }
        .inv-item img { width: 100%; height: 70px; object-fit: cover; }
        .inv-item.selected { border-color: var(--primary); box-shadow: 0 0 10px var(--primary); }

        .battle-arena { width: 100%; height: 100%; display: grid; grid-template-rows: 65% 35%; background: #111 url('https://www.transparenttextures.com/patterns/carbon-fibre.png'); }
        .field { display: flex; justify-content: space-between; padding: 40px; position: relative; }
        .fighter-zone { width: 35%; display: flex; flex-direction: column; align-items: center; transition: 0.3s; }
        .fighter-img { width: 220px; height: 280px; object-fit: contain; filter: drop-shadow(0 0 15px rgba(0,0,0,0.8)); }
        
        .hp-bar-container { width: 100%; height: 20px; background: #222; border: 2px solid #eee; margin: 10px 0; border-radius: 10px; overflow: hidden; }
        .hp-fill { height: 100%; background: linear-gradient(90deg, #ff0000, #ffcc00); width: 100%; transition: width 0.4s; }
        
        .hud { background: #000; border-top: 4px solid var(--primary); display: grid; grid-template-columns: 1.5fr 2fr 1.5fr; padding: 10px; gap: 10px; }
        .move-panel { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .combat-log { background: #050505; border: 1px solid #222; padding: 8px; overflow-y: auto; font-size: 0.85rem; color: #aaa; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .shake { animation: shakeAnim 0.3s; }
        @keyframes shakeAnim { 0% { transform: translate(2px, 1px); } 50% { transform: translate(-2px, -1px); } 100% { transform: translate(0,0); } }
    </style>
</head>
<body>

    <div class="watermark">BETA v1.3</div>

    <div id="login-screen" class="screen">
        <h1 style="font-size: 5rem; color: var(--primary); text-shadow: 5px 5px 0px var(--secondary);">THUG-E-MON</h1>
        <p style="letter-spacing: 5px; color: var(--accent);">STREETS OF NEW YORK</p>
        <div style="margin: 20px 0; display:flex; flex-direction:column;">
            <input type="text" id="username-input" placeholder="USERNAME" maxlength="12">
            <input type="password" id="password-input" placeholder="PASSWORD">
        </div>
        <div>
            <button class="btn" onclick="login()">LOGIN / JOIN</button>
            <button class="btn btn-danger" onclick="playGuest()">GUEST ACCESS</button>
        </div>
    </div>

    <div id="lobby-screen" class="screen hidden">
        <div style="width: 100%; display: flex; justify-content: space-between; padding: 15px 30px; background: #000;">
            <h2><span style="color:var(--accent)">></span> <span id="player-name-display" style="color: var(--primary)"></span></h2>
            <button class="btn btn-danger" style="padding: 5px 15px; font-size: 0.8rem;" onclick="logout()">LOGOUT</button>
        </div>

        <div class="dashboard">
            <div class="panel">
                <h3>STREET LEGENDS</h3>
                <div id="leaderboard-list">Connect to save wins...</div>
            </div>

            <div class="panel" style="text-align: center;">
                <h1 style="color: var(--primary); font-size: 2.5rem;">STREET BATTLES</h1>
                <button class="btn" style="width: 90%; margin: 10px 0;" onclick="alert('Public PvP requires database config!')">PUBLIC QUEUE</button>

                <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; margin: 10px 0;">
                    <h4>PRIVATE ROOM</h4>
                    <input type="text" id="room-code" placeholder="CODE" style="width: 80px;">
                    <button class="btn" onclick="alert('Database needed for Private Rooms')">GO</button>
                </div>

                <button class="btn btn-danger" style="width: 90%;" onclick="startBotFight()">PRACTICE (VS BOT)</button>
            </div>

            <div class="panel">
                <h3>MY THUGS</h3>
                <div id="inventory-grid" class="inventory-grid"></div>
                <h3 id="selected-fighter-display" style="color: var(--primary); margin-top: 15px;">Dreamybull</h3>
            </div>
        </div>
    </div>

    <div id="battle-screen" class="screen hidden">
        <div class="battle-arena">
            <div class="field">
                <div class="fighter-zone" id="enemy-zone">
                    <h3 id="enemy-name">OPPONENT</h3>
                    <div class="hp-bar-container"><div class="hp-fill" id="enemy-hp"></div></div>
                    <img id="enemy-img" class="fighter-img" src="">
                </div>
                <div style="position: absolute; top: 10%; left: 50%; transform: translateX(-50%); text-align: center;">
                    <h2 id="battle-main-text" style="font-size: 3rem; color: var(--primary);">FIGHT!</h2>
                </div>
                <div class="fighter-zone" id="player-zone">
                    <img id="player-img" class="fighter-img" src="">
                    <div class="hp-bar-container"><div class="hp-fill" id="player-hp"></div></div>
                    <h3 id="my-fighter-name">ME</h3>
                </div>
            </div>
            <div class="hud">
                <div class="combat-log" id="combat-log"></div>
                <div class="move-panel" id="move-buttons"></div>
                <button class="btn btn-danger" onclick="location.reload()">RUN</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getDatabase, ref, set, get, onValue, update } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAPI4KkZ6SCTloUFbZSROIq1neHZJUG4h8",
            authDomain: "thugemon.firebaseapp.com",
            projectId: "thugemon",
            databaseURL: "https://thugemon-default-rtdb.firebaseio.com",
            appId: "1:102057383382:web:9ef9619ff9888f11544077"
        };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const GH_RAW = "https://raw.githubusercontent.com/gtatacotruck/Thug-e-mon/361d276e95bdf548f1d8c72932ef5698d84081fd";

        const THUGS = {
            "Dreamybull": { img: `${GH_RAW}/IMG_1637.jpeg`, hp: 120, moves: [{n:"Sperm Shot", p:25}, {n:"Meat Slap", p:30}, {n:"Semen Barrier", p:20, t:'h'}] },
            "Yes King": { img: `${GH_RAW}/IMG_1638.webp`, hp: 110, moves: [{n:"Royal Decree", p:22}, {n:"Scepter Bonk", p:28}, {n:"Feast", p:25, t:'h'}] },
            "Pop Monster": { img: `${GH_RAW}/IMG_1667.jpeg`, hp: 130, moves: [{n:"Poop Fling", p:18}, {n:"Diarrhea Blast", p:35}, {n:"Fiber Chew", p:20, t:'h'}] },
            "Cado": { img: `${GH_RAW}/IMG_1668.png`, hp: 160, moves: [{n:"Mukbang Slam", p:30}, {n:"Obesity Crush", p:40}, {n:"Snack Break", p:35, t:'h'}] }
        };

        let currentUser = null;
        let isGuest = false;
        let selectedThugKey = "Dreamybull";
        let pState = { hp: 100, max: 100 }, eState = { hp: 100, max: 100 };

        window.onload = async () => {
            const saved = localStorage.getItem('thug_user_v1');
            if (saved) {
                const creds = JSON.parse(saved);
                try {
                    const snap = await get(ref(db, 'users/' + creds.u));
                    if (snap.exists() && snap.val().password === creds.p) {
                        currentUser = snap.val();
                        if(!currentUser.inventory) currentUser.inventory = ["Dreamybull"];
                        initLobby();
                    }
                } catch(e) { console.log("Offline or DB error"); }
            }
        };

        window.login = async () => {
            const u = document.getElementById('username-input').value.trim();
            const p = document.getElementById('password-input').value.trim();
            if(!u || !p) return;
            const snap = await get(ref(db, 'users/' + u));
            if(snap.exists()){
                if(snap.val().password !== p) return alert("WRONG PASSWORD");
                currentUser = snap.val();
            } else {
                currentUser = { username: u, password: p, wins: 0, inventory: ["Dreamybull"] };
                await set(ref(db, 'users/' + u), currentUser);
            }
            if(!currentUser.inventory) currentUser.inventory = ["Dreamybull"];
            localStorage.setItem('thug_user_v1', JSON.stringify({u, p}));
            isGuest = false;
            initLobby();
        };

        window.playGuest = () => {
            currentUser = { username: "Guest_" + Math.floor(Math.random()*999), wins: 0, inventory: ["Dreamybull"] };
            isGuest = true;
            initLobby();
        };

        window.logout = () => { localStorage.removeItem('thug_user_v1'); location.reload(); };

        function initLobby() {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('lobby-screen').classList.remove('hidden');
            document.getElementById('player-name-display').innerText = currentUser.username;
            renderInventory();
            if(!isGuest) listenToLeaderboard();
        }

        function renderInventory() {
            const grid = document.getElementById('inventory-grid'); grid.innerHTML = "";
            currentUser.inventory.forEach(k => {
                const d = document.createElement('div');
                d.className = `inv-item ${k === selectedThugKey ? 'selected' : ''}`;
                d.innerHTML = `<img src="${THUGS[k].img}">`;
                d.onclick = () => { selectedThugKey = k; renderInventory(); document.getElementById('selected-fighter-display').innerText=k; };
                grid.appendChild(d);
            });
        }

        function listenToLeaderboard() {
            onValue(ref(db, 'users'), s => {
                const d = s.val(); if(!d) return;
                const sorted = Object.values(d).sort((a,b)=>b.wins-a.wins).slice(0,5);
                document.getElementById('leaderboard-list').innerHTML = sorted.map((u,i)=>`<div>#${i+1} ${u.username} (${u.wins}W)</div>`).join('');
            });
        }

        window.startBotFight = () => {
            const botThug = Object.keys(THUGS)[Math.floor(Math.random()*4)];
            setupBattleUI("STREET BOT", botThug);
            pState.hp = THUGS[selectedThugKey].hp; pState.max = pState.hp;
            eState.hp = THUGS[botThug].hp; eState.max = eState.hp;
            updateStats();
            log("Battle Start! Use your moves wisely.");
        };

        function setupBattleUI(name, thug) {
            document.getElementById('lobby-screen').classList.add('hidden');
            document.getElementById('battle-screen').classList.remove('hidden');
            document.getElementById('enemy-name').innerText = name;
            document.getElementById('enemy-img').src = THUGS[thug].img;
            document.getElementById('player-img').src = THUGS[selectedThugKey].img;
            document.getElementById('my-fighter-name').innerText = currentUser.username;
            
            const mBox = document.getElementById('move-buttons'); mBox.innerHTML = "";
            THUGS[selectedThugKey].moves.forEach(m => {
                const b = document.createElement('button'); b.className = 'btn'; b.innerText = m.n;
                b.onclick = () => executeTurn(m);
                mBox.appendChild(b);
            });
        }

        function executeTurn(move) {
            document.getElementById('move-buttons').style.pointerEvents = "none";
            document.getElementById('move-buttons').style.opacity = "0.5";
            
            if(move.t === 'h') pState.hp = Math.min(pState.max, pState.hp + move.p);
            else eState.hp -= move.p;
            
            log(`You used ${move.n}!`);
            updateStats();
            document.getElementById('enemy-zone').classList.add('shake');
            setTimeout(()=>document.getElementById('enemy-zone').classList.remove('shake'), 200);

            if(eState.hp <= 0) {
                log("OPPONENT KNOCKED OUT!");
                if(!isGuest) { currentUser.wins++; update(ref(db, 'users/'+currentUser.username), {wins: currentUser.wins}); }
                return setTimeout(()=>location.reload(), 2000);
            }

            setTimeout(() => {
                const dmg = 20; pState.hp -= dmg;
                log(`Bot hit back! -${dmg} HP`);
                updateStats();
                document.getElementById('player-zone').classList.add('shake');
                setTimeout(()=>document.getElementById('player-zone').classList.remove('shake'), 200);
                
                if(pState.hp <= 0) {
                    log("YOU GOT FOLDED.");
                    setTimeout(()=>location.reload(), 2000);
                } else {
                    document.getElementById('move-buttons').style.pointerEvents = "auto";
                    document.getElementById('move-buttons').style.opacity = "1";
                }
            }, 800);
        }

        function updateStats() {
            document.getElementById('player-hp').style.width = (pState.hp / pState.max * 100) + "%";
            document.getElementById('enemy-hp').style.width = (eState.hp / eState.max * 100) + "%";
        }

        function log(msg) {
            const l = document.getElementById('combat-log');
            l.innerHTML += `<div>> ${msg}</div>`;
            l.scrollTop = l.scrollHeight;
        }
    </script>
</body>
</html>
